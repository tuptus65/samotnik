class t{constructor(t,s){this.ctx=t,this.radius=s}draw(t,s){const i=this.radius,a="#000000",e=this.ctx.createRadialGradient(t-i/3,s-i/3,i/100,t,s,i);e.addColorStop(0,"#ffffff"),e.addColorStop(.1,"#ddd"),e.addColorStop(.3,"#777"),e.addColorStop(.6,a),this.ctx.beginPath(),this.ctx.arc(t,s,i,0,2*Math.PI),this.ctx.fillStyle=e,this.ctx.strokeStyle=a,this.ctx.fill(),this.ctx.stroke()}}class s{constructor(t,s){this.ctx=t,this.radius=s}draw(t,s){const i=this.radius,a="#555",e=this.ctx.createRadialGradient(t+i/4,s+i/4,i/4,t,s,i);e.addColorStop(0,"#999"),e.addColorStop(.8,a),this.ctx.beginPath(),this.ctx.arc(t,s,i,0,2*Math.PI),this.ctx.fillStyle=e,this.ctx.strokeStyle=a,this.ctx.fill(),this.ctx.stroke()}}class i{constructor(t,s){this.canvas=t,this.ctx=s,this.offscreenCanvas=document.createElement("canvas"),this.offscreenCanvas.width=t.width,this.offscreenCanvas.height=t.height,this.offscreenCtx=this.offscreenCanvas.getContext("2d"),this.boardGenerated=!1,this.radius=Math.round(.7*this.canvas.width/18),this.reset()}countBalls(){let t=0;for(let s=0;s<9;s++)for(let i=0;i<9;i++)1===this.board[s][i]&&(t+=1);return t}draw(){this.drawBoard();for(let t=0;t<9;t++)for(let s=0;s<9;s++)0===this.board[t][s]?this.drawHole(t,s):1===this.board[t][s]&&this.drawBall(t,s)}drawBoard(){if(this.boardGenerated)return void this.ctx.drawImage(this.offscreenCanvas,0,0);const t=this.offscreenCanvas.width/2,s=this.offscreenCanvas.height/2,i=4.5*this.radius*2.2,a=2.2*this.radius,e=i+.8*a,h=this.offscreenCtx;h.save(),h.shadowColor="rgba(0, 0, 0, 0.5)",h.shadowBlur=25,h.shadowOffsetY=12,h.beginPath(),h.arc(t,s,e,0,2*Math.PI),h.fillStyle="#3e2723",h.fill(),h.restore();const r=h.createRadialGradient(t,s,i-5,t,s,e);r.addColorStop(0,"#2b1b17"),r.addColorStop(.2,"#1a0f0d"),r.addColorStop(1,"#5d4037"),h.beginPath(),h.arc(t,s,i+.3*a,0,2*Math.PI),h.strokeStyle=r,h.lineWidth=a,h.stroke();const o=h.createRadialGradient(t-.2*i,s-.2*i,this.radius,t,s,i);o.addColorStop(0,"#8d6e63"),o.addColorStop(.8,"#5d4037"),o.addColorStop(1,"#3e2723"),h.beginPath(),h.arc(t,s,i,0,2*Math.PI),h.fillStyle=o,h.fill(),h.beginPath(),h.arc(t,s,i,0,2*Math.PI),h.strokeStyle="rgba(255, 255, 255, 0.12)",h.lineWidth=1.5,h.stroke(),this.boardGenerated=!0,this.ctx.drawImage(this.offscreenCanvas,0,0)}drawBall(s,i){if(1!==this.board[s][i])return;const a=this.calcCords(s,i);if(null===a)return;new t(this.ctx,this.radius).draw(a.x,a.y)}drawHole(t,i){if(0!==this.board[t][i])return;const a=this.calcCords(t,i);if(null===a)return;new s(this.ctx,this.radius).draw(a.x,a.y)}calcCords(t,s){if(-1===this.board[t][s])return null;const i=this.canvas.width/2,a=this.canvas.height/2,e=2.1*this.radius;return{x:i+(t-4)*e,y:a+(s-4)*e}}calcIndex(t,s){const i=this.canvas.width/2,a=this.canvas.height/2,e=2.1*this.radius,h=Math.round((t-i)/e+4),r=Math.round((s-a)/e+4);return h>=0&&h<=8&&r>=0&&r<=8&&this.board[h][r]>-1?{x:h,y:r}:null}hasDraggable(){for(let t=0;t<9;t++)for(let s=0;s<9;s++)if(1===this.board[t][s]){const i=this.calcCords(t,s);if(this.isDraggable(i.x,i.y))return!0}return!1}isDraggable(t,s){const i=this.calcIndex(t,s);if(i&&1===this.board[i.x][i.y]){if(i.x+2<9&&0===this.board[i.x+2][i.y]&&1===this.board[i.x+1][i.y])return!0;if(i.x-2>=0&&0===this.board[i.x-2][i.y]&&1===this.board[i.x-1][i.y])return!0;if(i.y+2<9&&0===this.board[i.x][i.y+2]&&1===this.board[i.x][i.y+1])return!0;if(i.y-2>=0&&0===this.board[i.x][i.y-2]&&1===this.board[i.x][i.y-1])return!0}return!1}isHole(t,s){const i=this.calcIndex(t,s);return i&&0===this.board[i.x][i.y]}setHole(t,s){this.board[t][s]=0}setBall(t,s){const i=this.calcCords(t,s);this.isHole(i.x,i.y)&&(this.board[t][s]=1)}reset(){this.board=[[-1,-1,-1,1,1,1,-1,-1,-1],[-1,-1,-1,1,1,1,-1,-1,-1],[-1,-1,-1,1,1,1,-1,-1,-1],[1,1,1,1,1,1,1,1,1],[1,1,1,1,1,1,1,1,1],[1,1,1,1,1,1,1,1,1],[-1,-1,-1,1,1,1,-1,-1,-1],[-1,-1,-1,1,1,1,-1,-1,-1],[-1,-1,-1,1,1,1,-1,-1,-1]];let t=!1;for(;!t;){const s=Math.floor(9*Math.random()),i=Math.floor(9*Math.random());1===this.board[s][i]&&(this.board[s][i]=0,t=!0)}}}class a{constructor(t){this.canvas=t,this.ctx=this.canvas.getContext("2d");const s=this.canvas.getBoundingClientRect();this.position={x:s.left,y:s.top},this.board=new i(this.canvas,this.ctx),this.is_dragged=!1,this.lastCords=null,this.canvas.addEventListener("mousedown",t=>this.movedDown(t)),this.canvas.addEventListener("mousemove",t=>this.moved(t)),this.canvas.addEventListener("mouseup",t=>this.movedUp(t)),this.canvas.addEventListener("touchstart",t=>{t.preventDefault(),this.movedDown(t.touches[0])},{passive:!1}),this.canvas.addEventListener("touchmove",t=>{t.preventDefault(),this.moved(t.touches[0])},{passive:!1}),this.canvas.addEventListener("touchend",t=>{this.movedUp(t.changedTouches[0])})}resetGame(){this.game_over=!1,this.winer=!1,this.board.reset(),this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.board.draw()}run(){this.resetGame()}endGame(){const t=this.board.countBalls();this.winer=1===t,this.drawEndGame()}drawEndGame(){const t=this.board.countBalls(),s=this.canvas.width/2,i=this.canvas.height/2;this.ctx.save(),this.ctx.fillStyle="rgba(0, 0, 0, 0.5)",this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height),this.ctx.fillStyle="rgba(44, 62, 80, 0.8)",this.ctx.fillRect(0,i-70,this.canvas.width,140),this.ctx.strokeStyle="#f1c40f",this.ctx.lineWidth=2,this.ctx.beginPath(),this.ctx.moveTo(0,i-70),this.ctx.lineTo(this.canvas.width,i-70),this.ctx.moveTo(0,i+70),this.ctx.lineTo(this.canvas.width,i+70),this.ctx.stroke(),this.ctx.textAlign="center",this.ctx.textBaseline="middle",this.ctx.shadowColor="rgba(0, 0, 0, 1)",this.ctx.shadowBlur=10,this.ctx.font="bold 50px Arial",this.ctx.fillStyle=this.winer?"#f1c40f":"#ecf0f1";const a=this.winer?"PERFEKCJA!":"KONIEC GRY";this.ctx.fillText(a,s,i-15),this.ctx.shadowBlur=5,this.ctx.font="24px Arial",this.ctx.fillStyle="#bdc3c7";let e=`Pozostało kulek: ${t}`;1===t&&(e="Została tylko jedna kulka! Brawo!"),this.ctx.fillText(e,s,i+35),this.ctx.restore(),this.ctx.font="bold 20px Arial",this.ctx.fillStyle="#f1c40f",this.ctx.fillText("KLIKNIJ, ABY ZAGRAĆ PONOWNIE",s-100,i+100),this.game_over=!0}movedDown(t){this.game_over&&this.resetGame();const s=this.relPosition(t.clientX,t.clientY);if(this.board.isDraggable(s.x,s.y)){const t=this.board.calcIndex(s.x,s.y);this.is_dragged=!0,this.lastCords=t,this.board.setHole(t.x,t.y),this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.board.draw(),this.drawMovedBall(s.x,s.y)}}moved(t){if(!this.is_dragged)return;this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.board.draw();const s=this.relPosition(t.clientX,t.clientY);this.drawMovedBall(s.x,s.y)}movedUp(t){if(!this.is_dragged)return;const s=this.relPosition(t.clientX,t.clientY),i=this.board.calcIndex(s.x,s.y),a=i?i.x-this.lastCords.x:0,e=i?i.y-this.lastCords.y:0,h=2===Math.abs(a)&&0===e||2===Math.abs(e)&&0===a;if(i&&this.board.isHole(s.x,s.y)&&h){const t=i.x-a/2,s=i.y-e/2;1===this.board.board[t][s]?(this.board.setBall(i.x,i.y),this.board.setHole(t,s)):this.board.setBall(this.lastCords.x,this.lastCords.y)}else this.board.setBall(this.lastCords.x,this.lastCords.y);this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.board.draw(),this.is_dragged=!1,this.lastCords=null,this.board.hasDraggable()||this.endGame()}drawMovedBall(s,i){this.ctx.save(),this.ctx.shadowColor="transparent",this.ctx.shadowBlur=0,this.ctx.shadowOffsetX=0,this.ctx.shadowOffsetY=0;new t(this.ctx,this.board.radius).draw(s,i),this.ctx.restore()}relPosition(t,s){return{x:Math.round(t-this.position.x),y:Math.round(s-this.position.y)}}}export{a as Game};
